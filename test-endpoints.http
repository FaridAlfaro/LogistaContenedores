### LogistaContenedores - API Gateway Test
### Base URL: http://localhost:8085 (Gateway) o http://localhost:8082/8083 (directo)
### Documentación: Consultar GUIA_TESTING.md

@baseUrl = http://localhost:8085
@baseUrlLogistica = http://localhost:8082
@baseUrlFlota = http://localhost:8083
@token_cliente = YOUR_CLIENTE_TOKEN_HERE
@token_operador = YOUR_OPERADOR_TOKEN_HERE
@token_transportista = YOUR_TRANSPORTISTA_TOKEN_HERE
@nro_solicitud =
@idTramo = 1
@idCamion = 1
@idTransportista = 1
@idDeposito = 1
@idTarifa = 1 

### ========================================
### SOLICITUDES (ms-solicitudes)
### ========================================

### 1. Crear nueva solicitud (Rol: CLIENTE)
# Este endpoint crea una nueva solicitud y devuelve un número de solicitud único
# La solicitud se crea en estado BORRADOR
POST {{baseUrl}}/api/v1/solicitudes
Authorization: Bearer {{token_cliente}}
Content-Type: application/json

{
  "idCliente": "cliente-001",
  "idContenedor": "contenedor-99",
  "origen": {
    "dir": "Puerto Buenos Aires",
    "lat": -34.6037,
    "lon": -58.3816
  },
  "destino": {
    "dir": "Puerto La Plata",
    "lat": -34.7912,
    "lon": -57.9736
  }
}

###
### 2. Obtener solicitud por número (Rol: CLIENTE)
# Obtiene los detalles de una solicitud específica usando su número (nro)
# Reemplaza "{{nro_solicitud}}" con el número devuelto por la creación
GET {{baseUrl}}/api/v1/solicitudes/{{nro_solicitud}}
Authorization: Bearer {{token_cliente}}

###
### 3. Listar solicitudes pendientes (Rol: OPERADOR)
# Lista todas las solicitudes en estado BORRADOR
# Solo accesible para operadores
GET {{baseUrl}}/api/v1/solicitudes/pendientes
Authorization: Bearer {{token_operador}}

###
### 4. Aceptar solicitud (Rol: OPERADOR)
# Cambia el estado de una solicitud de BORRADOR a ACEPTADA
# Requiere el número de solicitud como parámetro de ruta
PUT {{baseUrl}}/api/v1/solicitudes/{{nro_solicitud}}/aceptar
Authorization: Bearer {{token_operador}}

###
### ========================================
### MS LOGÍSTICA - Endpoints
### ========================================

### 1. Crear Depósito
# Crea un nuevo depósito en el sistema
POST {{baseUrl}}/api/v1/depositos
Content-Type: application/json

{
  "nombre": "Depósito Central Buenos Aires",
  "direccion": "Av. Corrientes 1234, CABA",
  "latitud": -34.6037,
  "longitud": -58.3816,
  "costoEstadiaDiario": 5000.0
}

###
### 2. Crear Tarifa
# Crea una nueva tarifa vigente desde una fecha
POST {{baseUrl}}/api/v1/tarifas
Content-Type: application/json

{
  "valorKMBase": 150.0,
  "costoLitroCombustible": 850.0,
  "fechaVigencia": "2024-01-01"
}

###
### 3. Calcular Ruta (GET)
# Calcula distancia, tiempo y costo estimado de una ruta
GET {{baseUrl}}/api/v1/rutas/calcular?latOrigen=-34.6037&lonOrigen=-58.3816&latDestino=-34.7912&lonDestino=-57.9736&idTarifa={{idTarifa}}

###
### 4. Calcular Ruta con Depósitos (GET)
# Calcula ruta pasando por depósitos intermedios
GET {{baseUrl}}/api/v1/rutas/calcular?latOrigen=-34.6037&lonOrigen=-58.3816&latDestino=-34.7912&lonDestino=-57.9736&idDepositos={{idDeposito}}&idTarifa={{idTarifa}}

###
### 5. Planificar Ruta (POST)
# Planifica una ruta completa con tramos, calculando distancias y costos
POST {{baseUrl}}/api/v1/rutas/planificar
Content-Type: application/json

{
  "nroSolicitud": "SOL-2024-001",
  "idDepositos": [{{idDeposito}}],
  "latOrigen": -34.6037,
  "lonOrigen": -58.3816,
  "latDestino": -34.7912,
  "lonDestino": -57.9736,
  "idTarifa": {{idTarifa}}
}

###
### 6. Iniciar Tramo (INTERNO)
# Marca un tramo como iniciado. Usado internamente por MS Flota
PUT {{baseUrl}}/api/v1/tramos/{{idTramo}}/iniciar

###
### 7. Finalizar Tramo (INTERNO)
# Marca un tramo como finalizado con kilómetros recorridos
PUT {{baseUrl}}/api/v1/tramos/{{idTramo}}/finalizar?kmRecorridos=125.5

###
### ========================================
### MS FLOTA VIAJES - Endpoints
### ========================================

### 1. Crear Transportista (Rol: OPERADOR)
# Crea un nuevo transportista en el sistema
POST {{baseUrl}}/api/flota/transportistas
Authorization: Bearer {{token_operador}}
Content-Type: application/json

{
  "nombre": "Juan Pérez",
  "licencia": "LIC12345678",
  "contacto": "juan.perez@email.com"
}

###
### 2. Crear Camión (Rol: OPERADOR)
# Registra un nuevo camión asociado a un transportista
POST {{baseUrl}}/api/flota/camiones
Authorization: Bearer {{token_operador}}
Content-Type: application/json

{
  "dominio": "AY 123 BC",
  "capacidadPeso": 20000.0,
  "capacidadVolumen": 50.0,
  "idTransportista": {{idTransportista}},
  "costoPorKm": 120.0,
  "consumoCombustiblePromedio": 2.5
}

###
### 3. Obtener Camión por ID (Rol: OPERADOR)
# Obtiene los detalles de un camión específico
GET {{baseUrl}}/api/flota/camiones/{{idCamion}}
Authorization: Bearer {{token_operador}}

###
### 4. Obtener Camiones Disponibles (Rol: OPERADOR)
# Busca camiones disponibles que cumplan con los requisitos de capacidad
POST {{baseUrl}}/api/flota/camiones/disponibles
Authorization: Bearer {{token_operador}}
Content-Type: application/json

{
  "capacidadPesoRequerida": 15000.0,
  "capacidadVolumenRequerida": 40.0
}

###
### 5. Obtener Camiones por Transportista (Rol: OPERADOR)
# Lista todos los camiones de un transportista específico
GET {{baseUrl}}/api/flota/transportistas/{{idTransportista}}/camiones
Authorization: Bearer {{token_operador}}

###
### 6. Iniciar Tramo (Rol: TRANSPORTISTA)
# Inicia la ejecución de un tramo con un camión específico
POST {{baseUrl}}/api/flota/tramos/{{idTramo}}/iniciar
Authorization: Bearer {{token_transportista}}
Content-Type: application/json

{
  "dominioCamion": "AY 123 BC"
}

###
### 7. Finalizar Tramo (Rol: TRANSPORTISTA)
# Finaliza un tramo en curso registrando los kilómetros recorridos
POST {{baseUrl}}/api/flota/tramos/{{idTramo}}/finalizar
Authorization: Bearer {{token_transportista}}
Content-Type: application/json

{
  "dominioCamion": "AY 123 BC",
  "kmRecorridos": 125.5
}

###
### ========================================
### INSTRUCCIONES DE USO
### ========================================

# 1. Obtener tokens de Keycloak:
#    POST http://localhost:8088/realms/tpi-backend/protocol/openid-connect/token
#    Body (form-data):
#      - grant_type: password
#      - client_id: <your-client-id>
#      - username: <usuario>
#      - password: <password>
#
#    Respuesta incluye "access_token" que colocas en las variables correspondientes
#
#    Ejemplo con cURL:
#    curl -X POST http://localhost:8088/realms/tpi-backend/protocol/openid-connect/token \
#      -H "Content-Type: application/x-www-form-urlencoded" \
#      -d "grant_type=password" \
#      -d "client_id=<client-id>" \
#      -d "username=<usuario>" \
#      -d "password=<password>"

# 2. Flujo de prueba completo recomendado:
#    
#    A) MS LOGÍSTICA:
#       a) Crear depósito (endpoint 1)
#       b) Crear tarifa (endpoint 2)
#       c) Calcular ruta (endpoint 3 o 4)
#       d) Planificar ruta (endpoint 5) - esto crea tramos
#
#    B) MS FLOTA:
#       a) Crear transportista (endpoint 1) - requiere token OPERADOR
#       b) Crear camión (endpoint 2) - requiere token OPERADOR
#       c) Obtener camiones disponibles (endpoint 4) - requiere token OPERADOR
#       d) Iniciar tramo (endpoint 6) - requiere token TRANSPORTISTA
#       e) Finalizar tramo (endpoint 7) - requiere token TRANSPORTISTA

# 3. Variables de entorno:
#    - {{baseUrl}}: URL base del API Gateway (por defecto 8085)
#    - {{baseUrlLogistica}}: URL directa MS Logística (8082)
#    - {{baseUrlFlota}}: URL directa MS Flota (8083)
#    - {{token_cliente}}: Token JWT con rol CLIENTE
#    - {{token_operador}}: Token JWT con rol OPERADOR
#    - {{token_transportista}}: Token JWT con rol TRANSPORTISTA
#    - {{nro_solicitud}}: Número de la solicitud a manipular
#    - {{idTramo}}: ID del tramo (obtenido al planificar ruta)
#    - {{idCamion}}: ID del camión
#    - {{idTransportista}}: ID del transportista
#    - {{idDeposito}}: ID del depósito
#    - {{idTarifa}}: ID de la tarifa

# 4. Extensiones recomendadas para VS Code:
#    - REST Client (humao.rest-client) - Permite ejecutar estos archivos .http directamente
#    - Thunder Client
#    - Hoppscotch (en línea)

# 5. Swagger UI:
#    - MS Logística: http://localhost:8082/swagger-ui.html
#    - MS Flota: http://localhost:8083/swagger-ui.html
#    - Eureka Dashboard: http://localhost:8761

### Fin de colección de pruebas
